@startuml System Context Diagram
!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/release/1-0/C4_Component.puml

skinparam BackgroundColor #00000000

Person(caseworker, "PPCS Caseworker")
' Person(mhcs_caseworker, "MHCS Caseworker")
' Person(ppo_caseworker, "PPO Caseworker")
Person(offender, "Offender", "An offender or authorised agent, such as a solicitor")

System_Boundary(authSys, "Authentication and Authorisation") {
  System_Ext(IAM, "HMPPS Auth", "Allows users to login to digital services")
  Rel(caseworker, IAM, "Logs in with", "OAuth/SAML")
  ' Rel(mhcs_caseworker, IAM, "Logs in with", "OAuth/SAML")
  ' Rel(ppo_caseworker, IAM, "Logs in with", "OAuth/SAML")
  Rel(offender, IAM, "Logs in with", "OAuth/SAML")
}

System_Ext(notify, "GOV.UK Notify")

System_Boundary(moj, "Existing MoJ Web Services") {
  System_Ext(PrisonAPI, "Prison API", "REST API for accessing offender data in NOMIS")
  System_Ext(CommunityAPI, "Community API", "Community Offender REST API which exposes nDelius offender data in a canonical form")
  System_Ext(OASysAPI, "Offender Assessment API", "REST API for accessing offender assessments data in the OASys system")
}

System_Boundary(ppud, "New Data Services") {
  Container(ppudAPI, "Parole API", "node.js / Java", "Exposes data concerned with parole.")
  SystemDb_Ext(legacyDB, "Legacy PPUD DB", "MSSQL")
  ContainerDb(ppudDB, "Parole DB", "RDS")
  ContainerDb(docStorage, "Document Store", "S3 Bucket")
  Rel(ppudAPI, legacyDB, "Fetches legacy data on demand from")
  Rel(ppudAPI, ppudDB, "Writes data to and fetches data from")
  Rel(ppudAPI, docStorage, "Manages files in")
}

System_Boundary(consumers, "Data Consumers") {
  System_Ext(ppudReporting, "Analytical Platform", "MoJ reporting system")
  Rel(ppudReporting, ppudAPI, "fetches data from", "HTTPS")
}

System_Boundary(services, "New Frontend Services") {

  Container(review, "Manage a Review", "node.js")
  Rel(caseworker, review, "Uses", "HTTPS")
  Rel(offender, review, "Views data in", "HTTPS")
  Rel(review, ppudAPI, "Fetches data from", "HTTPS")
  Rel(review, PrisonAPI, "Fetches offender data from", "HTTPS")
  Rel(review, CommunityAPI, "Fetches offender data from", "HTTPS")
  Rel(review, OASysAPI, "Fetches offender assessments from", "HTTPS")
  Rel(review, notify, "Notifies stakeholders with", "HTTPS")

  ' Container(recall, "Manage a Recall", "node.js")
  ' Rel(caseworker, recall, "Uses", "HTTPS")
  ' Rel(recall, ppudAPI, "Fetches data from", "HTTPS")
  ' Rel(recall, PrisonAPI, "Fetches offender data from", "HTTPS")
  ' Rel(recall, CommunityAPI, "Fetches offender data from", "HTTPS")
  ' Rel(recall, OASysAPI, "Fetches offender assessments from", "HTTPS")
  ' Rel(recall, notify, "Notifies stakeholders with", "HTTPS")

  ' Container(movements, "Move to or from Hospital", "node.js")
  ' Rel(mhcs_caseworker, movements, "Uses", "HTTPS")
  ' Rel(movements, ppudAPI, "Fetches data from", "HTTPS")
  ' Rel(movements, PrisonAPI, "Fetches offender data from", "HTTPS")
  ' Rel(movements, notify, "Notifies stakeholders with", "HTTPS")

  ' Container(complaints, "Investigate Complaints", "node.js")
  ' Rel(ppo_caseworker, complaints, "Uses", "HTTPS")
  ' Rel(complaints, ppudAPI, "Fetches data from", "HTTPS")
  ' Rel(complaints, PrisonAPI, "Fetches offender data from", "HTTPS")
  ' Rel(complaints, notify, "Notifies stakeholders with", "HTTPS")

  ' Container(deaths, "Investigate Deaths", "node.js")
  ' Rel(ppo_caseworker, deaths, "Uses", "HTTPS")
  ' Rel(deaths, ppudAPI, "Fetches data from", "HTTPS")
  ' Rel(deaths, PrisonAPI, "Fetches offender data from", "HTTPS")
  ' Rel(deaths, notify, "Notifies stakeholders with", "HTTPS")

}

@enduml
